// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

var Belt_Array = require("bs-platform/lib/js/belt_Array.js");
var Belt_MapString = require("bs-platform/lib/js/belt_MapString.js");

var initialState = {
  recipes: undefined,
  tags: undefined
};

function addRecipe(state, id, title, ingredients, instructions) {
  return {
          recipes: Belt_MapString.set(state.recipes, id, {
                id: id,
                title: title,
                ingredients: ingredients,
                instructions: instructions,
                tags: [],
                updatedAt: Date.now(),
                deleted: false
              }),
          tags: state.tags
        };
}

function createOrUpdateTaggedRecipes(taggedRecipesOption, tag, recipeId) {
  if (taggedRecipesOption !== undefined) {
    return {
            tag: taggedRecipesOption.tag,
            recipes: Belt_Array.concat(taggedRecipesOption.recipes, [recipeId]),
            updatedAt: Date.now(),
            deleted: taggedRecipesOption.deleted
          };
  } else {
    return {
            tag: tag,
            recipes: [recipeId],
            updatedAt: Date.now(),
            deleted: false
          };
  }
}

function addTag(state, recipeId, tag) {
  var recipeOption = Belt_MapString.get(state.recipes, recipeId);
  if (recipeOption === undefined) {
    return state;
  }
  var recipeTags = Belt_Array.concat(recipeOption.tags, [tag]);
  var recipes = Belt_MapString.set(state.recipes, recipeOption.id, {
        id: recipeOption.id,
        title: recipeOption.title,
        ingredients: recipeOption.ingredients,
        instructions: recipeOption.instructions,
        tags: recipeTags,
        updatedAt: recipeOption.updatedAt,
        deleted: recipeOption.deleted
      });
  var tags = Belt_MapString.update(state.tags, tag, (function (taggedRecipesOption) {
          return createOrUpdateTaggedRecipes(taggedRecipesOption, tag, recipeOption.id);
        }));
  return {
          recipes: recipes,
          tags: tags
        };
}

function reducer(state, action) {
  if (action.TAG === /* AddRecipe */0) {
    return addRecipe(state, action.id, action.title, action.ingredients, action.instructions);
  } else {
    return addTag(state, action.recipeId, action.tag);
  }
}

var currentState = {
  contents: initialState
};

function getState(param) {
  return currentState.contents;
}

function dispatch(action) {
  currentState.contents = reducer(currentState.contents, action);
  
}

var Reducer = {
  getState: getState,
  dispatch: dispatch
};

exports.initialState = initialState;
exports.addRecipe = addRecipe;
exports.createOrUpdateTaggedRecipes = createOrUpdateTaggedRecipes;
exports.addTag = addTag;
exports.reducer = reducer;
exports.Reducer = Reducer;
/* No side effect */
